<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELEC 3500 Visualization Tool</title>
    <script src='https://cdn.plot.ly/plotly-2.27.0.min.js'></script>
    <script type="module" src="main.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f4f7f9; color: #333; }
        .homepage-header { background: #fff; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #007bff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo-left img { height: 110px; width: auto; display: block; }
        .logo-right img { height: 70px; width: auto; display: block; }
        .title-container h1 { margin: 0; color: #0056b3; font-size: 28px; text-align: center; }
        .container { max-width: 1200px; margin: 30px auto; background: #fff; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        #home-view { text-align: center; }
        .module-grid { display: flex; flex-direction: column; align-items: center; gap: 20px; margin-top: 30px; }
        .nav-card { background: #fff; border: 2px solid #eee; padding: 25px; border-radius: 12px; width: 450px; transition: 0.3s; cursor: pointer; text-align: center; }
        .nav-card:hover { border-color: #007bff; transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .module-view { display: none; }
        .back-btn { margin-bottom: 20px; padding: 10px 20px; cursor: pointer; background: #6c757d; color: white; border: none; border-radius: 6px; }
        .tab-container { display: flex; margin-top: 20px; }
        .tab-button { flex: 1; padding: 12px; cursor: pointer; border: 1px solid #ddd; background: #f8f9fa; border-bottom: none; border-radius: 8px 8px 0 0; }
        .tab-button.active { background: #fff; border-top: 3px solid #007bff; font-weight: bold; }
        .tab-content { display: none; padding: 20px; border: 1px solid #ddd; border-top: none; border-radius: 0 0 8px 8px; }
        .tab-content.active { display: block; }
        .control-panel { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #eee; }
        input[type="range"] { width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

    <header class="homepage-header">
        <div class="logo-left"><img src="ece_logo.jpg" alt="ECE Logo"></div>
        <div class="title-container"><h1>ELEC 3500 Visualization Tool</h1></div>
        <div class="logo-right"><img src="logo_device.svg" alt="Device Logo"></div>
    </header>

    <div id="home-view" class="container">
        <h2>Select a Simulation Module</h2>
        <div class="module-grid">
            <div class="nav-card" onclick="switchView('module1')">
                <h3 style="color:#007bff">Module 1</h3>
                <p>Fermi-Dirac Statistics & Carrier Occupancy</p>
            </div>
            <div class="nav-card" onclick="switchView('module2')">
                <h3 style="color:#28a745">Module 2</h3>
                <p>PN Junction Electrostatics</p>
            </div>
            <div class="nav-card" onclick="switchView('module3')">
                <h3 style="color:#dc3545">Module 3</h3>
                <p>PN Junction Current & Injection</p>
            </div>
        </div>
    </div>

    <div id="module1-view" class="container module-view">
        <button class="back-btn" onclick="switchView('home')">← Back to Portal</button>
        <h2 style="color:#007bff">Module 1: Fermi-Dirac Statistics</h2>
        <div class="control-panel" id="m1-controls">
            <label><b>View Carrier:</b></label>
            <label><input type="radio" name="carrierType" value="elec" checked onchange="updatePlot()"> Electrons</label>
            <label style="margin-left:15px"><input type="radio" name="carrierType" value="hole" onchange="updatePlot()"> Holes</label>
            <br><br>
            <label>Temperature: <span id="tempValue">300</span> K</label>
            <input type="range" id="tempSlider" min="0" max="600" value="300" oninput="updatePlot()">
        </div>
        <div class="tab-container">
            <button class="tab-button" onclick="openTab(event, 'intrinsic')">Intrinsic Silicon</button>
            <button class="tab-button active" onclick="openTab(event, 'nType')">N-Type Doping</button>
            <button class="tab-button" onclick="openTab(event, 'pType')">P-Type Doping</button>
        </div>
        <div id="intrinsic" class="tab-content">Intrinsic Mode: Fermi level is fixed at mid-gap ($E_i$).</div>
        <div id="nType" class="tab-content active">
            <label>Donor ($N_d$): 10<sup><span id="ndValueN">14.0</span></sup> cm⁻³</label>
            <input type="range" id="ndSliderN" min="12" max="19" value="14" step="0.1" oninput="updatePlot()">
        </div>
        <div id="pType" class="tab-content">
            <label>Acceptor ($N_a$): 10<sup><span id="naValueP">14.0</span></sup> cm⁻³</label>
            <input type="range" id="naSliderP" min="12" max="19" value="14" step="0.1" oninput="updatePlot()">
        </div>
        <div id="plot"></div>
    </div>

    <div id="module2-view" class="container module-view">
        <button class="back-btn" onclick="switchView('home')">← Back to Portal</button>
        <h2 style="color:#28a745">Module 2: PN Junctions</h2>
        <div class="control-panel" id="m2-controls">
            <div style="display:flex; gap:20px;">
                <div style="flex:1">
                    <label>Acceptor ($N_A$): 10<sup><span id="naValueM2">16.0</span></sup> cm⁻³</label>
                    <input type="range" id="naSliderMod2" min="14" max="18" value="16" step="0.1" oninput="updateModule2()">
                </div>
                <div style="flex:1">
                    <label>Donor ($N_D$): 10<sup><span id="ndValueM2">16.0</span></sup> cm⁻³</label>
                    <input type="range" id="ndSliderMod2" min="14" max="18" value="16" step="0.1" oninput="updateModule2()">
                </div>
            </div>
            <br>
            <label>Applied Bias ($V_a$): <span id="biasValue">0.00</span> V</label>
            <input type="range" id="biasSlider" min="-5" max="0.6" value="0" step="0.05" oninput="updateModule2()">
            <div style="margin-top: 15px; text-align: center;">
                <button onclick="setDopingReference()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">Set Current Doping as Reference</button>
            </div>
        </div>
        <div id="pnPlot" style="height: 850px;"></div>
    </div>

    <div id="module3-view" class="container module-view">
        <button class="back-btn" onclick="switchView('home')">← Back to Portal</button>
        <h2 style="color:#dc3545">Module 3: PN Junction Current & Bands</h2>
        <div class="control-panel">
            <div style="display:flex; gap:20px;">
                <div style="flex:1">
                    <label>Acceptor ($N_A$): 10<sup><span id="naValueM3">17.5</span></sup> cm⁻³</label>
                    <input type="range" id="naSliderMod3" min="14" max="18" value="17.5" step="0.1" oninput="updateModule3()">
                </div>
                <div style="flex:1">
                    <label>Donor ($N_D$): 10<sup><span id="ndValueM3">17.5</span></sup> cm⁻³</label>
                    <input type="range" id="ndSliderMod3" min="14" max="18" value="17.5" step="0.1" oninput="updateModule3()">
                </div>
            </div>
            <br>
            <label>Applied Bias ($V_a$): <span id="biasValueM3">0.00</span> V</label>
            <input type="range" id="biasSliderM3" min="-12" max="0.8" value="0" step="0.1" oninput="updateModule3()">
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 30px;">
            <div id="bandPlot" style="width: 100%; height: 500px; border: 1px solid #eee; border-radius: 8px;"></div>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div id="ivPlot" style="flex: 1; min-width: 450px; height: 450px;"></div>
                <div id="carrierPlot" style="flex: 1; min-width: 450px; height: 450px;"></div>
            </div>
        </div>
    </div>

    <script>
        function switchView(viewId) {
            document.querySelectorAll('.container, .module-view').forEach(v => v.style.display = 'none');
            const basePage = "elec3500visualization.html";
            if (window.stopAnimation) window.stopAnimation();
            if(viewId === 'home') {
                history.pushState({view: 'home'}, '', `/${basePage}`);
                document.getElementById('home-view').style.display = 'block';
            } else {
                history.pushState({view: viewId}, '', `/${basePage}/${viewId}`);
                if(window.resetToDefaults) window.resetToDefaults(viewId);
                document.getElementById(viewId + '-view').style.display = 'block';
                if(viewId === 'module1') setTimeout(window.updatePlot, 50);
                if(viewId === 'module2') setTimeout(window.updateModule2, 50);
                if(viewId === 'module3') setTimeout(window.updateModule3, 50);
            }
        }
        window.onpopstate = function(event) {
            const view = (event.state && event.state.view) ? event.state.view : 'home';
            document.querySelectorAll('.container, .module-view').forEach(v => v.style.display = 'none');
            if (window.stopAnimation) window.stopAnimation();
            if (view === 'home') document.getElementById('home-view').style.display = 'block';
            else {
                document.getElementById(view + '-view').style.display = 'block';
                if(view === 'module1') window.updatePlot();
                if(view === 'module2') window.updateModule2();
                if(view === 'module3') window.updateModule3();
            }
        };
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) tabcontent[i].style.display = "none";
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) tablinks[i].className = tablinks[i].className.replace(" active", "");
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            window.updatePlot();
        }
    </script>
</body>
</html>